<!doctype html>
<!--
============================================================================================================
P√ÅGINA INICIAL - SISTEMA DE GERENCIAMENTO DE LIVROS
============================================================================================================
Este arquivo HTML √© o template principal da aplica√ß√£o web.
Ele exibe a lista de livros e permite:
- Buscar livros por nome/t√≠tulo
- Importar livros via arquivo CSV
- Visualizar todos os livros cadastrados
- Excluir livros
============================================================================================================
-->

<html lang="pt-br">
<head>
  <!-- Configura√ß√µes b√°sicas da p√°gina -->
  <meta charset="utf-8" />  <!-- Define a codifica√ß√£o de caracteres (suporta acentos) -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <!-- Responsivo para mobile -->
  <title>Lista de livros</title>  <!-- T√≠tulo que aparece na aba do navegador -->
  
  <!-- Link para arquivo CSS externo (se existir) -->
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<!--
============================================================================================================
ESTILOS CSS (CSS INLINE)
============================================================================================================
Os estilos abaixo definem a apar√™ncia visual da p√°gina.
Eles est√£o inline (dentro do HTML) para facilitar, mas poderiam estar em um arquivo CSS separado.
============================================================================================================
-->
<style>
  /* Estilo do corpo da p√°gina */
  body {
    font-family: Arial, sans-serif;  /* Fonte padr√£o */
    max-width: 800px;  /* Largura m√°xima do conte√∫do */
    margin: 50px auto;  /* Centraliza a p√°gina (50px de margem superior, auto nas laterais) */
    padding: 20px;  /* Espa√ßamento interno */
    background-color: #e2e2e2;  /* Cor de fundo cinza claro */
  }
  
  /* Container principal (caixa branca com os livros) */
  .container {
    background-color: white;  /* Fundo branco */
    padding: 30px;  /* Espa√ßamento interno */
    border-radius: 8px;  /* Bordas arredondadas */
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);  /* Sombra sutil */
  }
  
  /* T√≠tulo principal */
  h1 {
    color: #333;  /* Cor do texto (cinza escuro) */
    margin-bottom: 30px;  /* Espa√ßamento abaixo do t√≠tulo */
  }
  
  /* Formul√°rios (busca e upload) */
  .upload-form {
    margin-bottom: 30px;  /* Espa√ßamento abaixo do formul√°rio */
    padding: 20px;  /* Espa√ßamento interno */
    background-color: #f9f9f9;  /* Fundo cinza muito claro */
    border-radius: 5px;  /* Bordas arredondadas */
  }
  
  /* Labels dos formul√°rios */
  .upload-form label {
    display: block;  /* Faz o label ocupar toda a largura */
    margin-bottom: 10px;  /* Espa√ßamento abaixo do label */
    font-weight: bold;  /* Texto em negrito */
  }
  
  /* Campo de arquivo (input file) */
  .upload-form input[type="file"] {
    margin-bottom: 10px;  /* Espa√ßamento abaixo do campo */
  }
  
  /* Bot√µes dos formul√°rios */
  .upload-form button {
    background-color: #4CAF50;  /* Cor verde */
    color: white;  /* Texto branco */
    padding: 10px 20px;  /* Espa√ßamento interno (vertical, horizontal) */
    border: none;  /* Sem borda */
    border-radius: 4px;  /* Bordas arredondadas */
    cursor: pointer;  /* Cursor vira "m√£o" ao passar o mouse */
    font-size: 16px;  /* Tamanho da fonte */
  }
  
  /* Efeito hover nos bot√µes (quando passa o mouse) */
  .upload-form button:hover {
    background-color: #45a049;  /* Verde mais escuro */
  }
  
  /* Container das mensagens flash (sucesso/erro) */
  .flash-messages {
    margin-bottom: 20px;  /* Espa√ßamento abaixo */
  }
  
  /* Estilo das mensagens flash */
  .flash-message {
    padding: 12px;  /* Espa√ßamento interno */
    margin-bottom: 10px;  /* Espa√ßamento entre mensagens */
    border-radius: 4px;  /* Bordas arredondadas */
    font-weight: bold;  /* Texto em negrito */
  }
  
  /* Mensagem de sucesso (verde) */
  .flash-success {
    background-color: #d4edda;  /* Fundo verde claro */
    color: #155724;  /* Texto verde escuro */
    border: 1px solid #c3e6cb;  /* Borda verde */
  }
  
  /* Mensagem de erro (vermelho) */
  .flash-error {
    background-color: #f8d7da;  /* Fundo vermelho claro */
    color: #721c24;  /* Texto vermelho escuro */
    border: 1px solid #f5c6cb;  /* Borda vermelha */
  }
  
  /* Lista de livros (sem marcadores) */
  .livros-list {
    list-style: none;  /* Remove os marcadores (bolinhas) da lista */
    padding: 0;  /* Remove o padding padr√£o */
  }
  
  /* Item individual de um livro */
  .livro-item {
    display: flex;  /* Layout flexbox (permite alinhar elementos lado a lado) */
    justify-content: space-between;  /* Espa√ßa os elementos (info √† esquerda, bot√£o √† direita) */
    align-items: center;  /* Alinha verticalmente ao centro */
    padding: 15px;  /* Espa√ßamento interno */
    margin-bottom: 10px;  /* Espa√ßamento entre itens */
    background-color: #f9f9f9;  /* Fundo cinza muito claro */
    border-radius: 5px;  /* Bordas arredondadas */
    border-left: 4px solid #4CAF50;  /* Borda esquerda verde (destaque visual) */
  }
  
  /* Informa√ß√µes do livro (t√≠tulo, autor, ID) */
  .livro-info {
    flex: 1;  /* Ocupa todo o espa√ßo dispon√≠vel */
  }
  
  /* ID do livro em negrito */
  .livro-info strong {
    color: #333;  /* Cor do texto */
    font-size: 18px;  /* Tamanho da fonte */
  }
  
  /* √Årea de a√ß√µes (bot√µes) */
  .livro-actions {
    margin-left: 20px;  /* Espa√ßamento √† esquerda */
  }
  
  /* Bot√£o de excluir */
  .btn-excluir {
    background-color: #f44336;  /* Cor vermelha */
    color: white;  /* Texto branco */
    padding: 8px 16px;  /* Espa√ßamento interno */
    border: none;  /* Sem borda */
    border-radius: 4px;  /* Bordas arredondadas */
    cursor: pointer;  /* Cursor vira "m√£o" */
    font-size: 14px;  /* Tamanho da fonte */
  }
  
  /* Efeito hover no bot√£o excluir */
  .btn-excluir:hover {
    background-color: #da190b;  /* Vermelho mais escuro */
  }
  
  /* Mensagem quando n√£o h√° livros */
  .empty-message {
    text-align: center;  /* Centraliza o texto */
    color: #666;  /* Cor cinza */
    padding: 40px;  /* Espa√ßamento interno */
    font-style: italic;  /* Texto em it√°lico */
  }
</style>

<!--
============================================================================================================
CONTE√öDO PRINCIPAL DA P√ÅGINA
============================================================================================================
-->

<div class="container">
  <!-- T√≠tulo da p√°gina -->
  <h1>üìö Lista de Livros</h1>

  <!--
  ==========================================================================================================
  MENSAGENS FLASH (SUCESSO/ERRO)
  ==========================================================================================================
  As mensagens flash s√£o mensagens tempor√°rias que aparecem ap√≥s uma a√ß√£o
  (ex: "Livro exclu√≠do com sucesso!", "Erro ao importar CSV", etc).
  
  O Flask armazena essas mensagens e as exibe aqui.
  Elas desaparecem ap√≥s serem visualizadas.
  ==========================================================================================================
  -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    <!-- get_flashed_messages() busca todas as mensagens flash armazenadas -->
    <!-- with_categories=true faz com que as mensagens venham com sua categoria (success/error) -->
    
    {% if messages %}
      <!-- Se houver mensagens, exibe cada uma -->
      <div class="flash-messages">
        {% for category, message in messages %}
          <!-- Loop que percorre todas as mensagens -->
          <!-- category = "success" ou "error" -->
          <!-- message = texto da mensagem -->
          <div class="flash-message flash-{{ category }}">
            <!-- flash-{{ category }} cria classes como "flash-success" ou "flash-error" -->
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!--
  ==========================================================================================================
  FORMUL√ÅRIO DE BUSCA DE LIVROS
  ==========================================================================================================
  Este formul√°rio permite ao usu√°rio buscar livros digitando parte do nome/t√≠tulo.
  
  Como funciona:
  1. Usu√°rio digita o nome do livro no campo de texto
  2. Clica no bot√£o "Buscar"
  3. O formul√°rio envia uma requisi√ß√£o GET para "/" com o par√¢metro "busca"
  4. O servidor filtra os livros e retorna apenas os que cont√™m o termo buscado
  5. Se houver uma busca ativa, aparece o bot√£o "Limpar" para voltar a ver todos os livros
  ==========================================================================================================
  -->
  <div class="upload-form">
    <form action="/" method="get" style="margin-bottom: 20px;">
      <!-- action="/" = envia para a p√°gina inicial -->
      <!-- method="get" = envia os dados via URL (query string) -->
      
      <label for="busca">üîç Buscar Livro:</label>
      <!-- Label do campo de busca -->
      
      <input 
        type="text" 
        id="busca" 
        name="busca" 
        placeholder="Digite o nome do livro..." 
        value="{{ busca if busca else '' }}" 
        style="padding: 8px; width: 300px; margin-right: 10px;"
      >
      <!-- 
      type="text" = campo de texto
      id="busca" = identificador √∫nico do campo
      name="busca" = nome do par√¢metro que ser√° enviado ao servidor
      placeholder = texto de exemplo que aparece quando o campo est√° vazio
      value="{{ busca if busca else '' }}" = mant√©m o texto digitado ap√≥s a busca
        - Se a vari√°vel "busca" existir, mostra seu valor
        - Se n√£o existir, mostra string vazia
      -->
      
      <button type="submit" style="background-color: #2196F3; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;">
        Buscar
      </button>
      <!-- Bot√£o que envia o formul√°rio -->
      
      {% if busca %}
        <!-- Se houver uma busca ativa, mostra o bot√£o "Limpar" -->
        <a href="/" style="margin-left: 10px; padding: 10px 20px; background-color: #666; color: white; text-decoration: none; border-radius: 4px; display: inline-block;">
          Limpar
        </a>
        <!-- Link que volta para a p√°gina inicial sem par√¢metros (limpa a busca) -->
      {% endif %}
    </form>
  </div>

  <!--
  ==========================================================================================================
  FORMUL√ÅRIO DE UPLOAD DE CSV
  ==========================================================================================================
  Este formul√°rio permite ao usu√°rio importar m√∫ltiplos livros de uma vez via arquivo CSV.
  
  Como funciona:
  1. Usu√°rio seleciona um arquivo CSV no computador
  2. Clica no bot√£o "Importar"
  3. O arquivo √© enviado para o servidor (rota /upload_csv)
  4. O servidor l√™ o CSV e importa todos os livros para o banco de dados
  5. Mostra mensagem de sucesso/erro e redireciona para a p√°gina inicial
  
  Formato esperado do CSV:
    id,titulo,autor
    1,Dom Casmurro,Machado de Assis
    2,1984,George Orwell
  ==========================================================================================================
  -->
  <div class="upload-form">
    <form action="/upload_csv" method="post" enctype="multipart/form-data">
      <!-- action="/upload_csv" = envia para a rota de upload -->
      <!-- method="post" = envia os dados via corpo da requisi√ß√£o (n√£o na URL) -->
      <!-- enctype="multipart/form-data" = necess√°rio para enviar arquivos -->
      
      <label for="arquivo">Importar CSV:</label>
      <!-- Label do campo de arquivo -->
      
      <input type="file" id="arquivo" name="arquivo" accept=".csv" required>
      <!-- 
      type="file" = campo para selecionar arquivo
      id="arquivo" = identificador √∫nico
      name="arquivo" = nome do par√¢metro que ser√° enviado ao servidor
      accept=".csv" = aceita apenas arquivos CSV
      required = campo obrigat√≥rio (n√£o pode enviar sem selecionar arquivo)
      -->
      
      <button type="submit">üì• Importar</button>
      <!-- Bot√£o que envia o formul√°rio -->
    </form>
  </div>

  <!--
  ==========================================================================================================
  LISTA DE LIVROS
  ==========================================================================================================
  Esta se√ß√£o exibe todos os livros cadastrados (ou os resultados da busca).
  
  Como funciona:
  1. O servidor passa a lista de livros para o template via vari√°vel "livros"
  2. Se houver livros, percorre cada um e exibe suas informa√ß√µes
  3. Cada livro mostra: ID, T√≠tulo e Autor
  4. Cada livro tem um bot√£o "Excluir" para remov√™-lo
  5. Se n√£o houver livros, mostra uma mensagem informativa
  ==========================================================================================================
  -->
  {% if livros %}
    <!-- Se a lista de livros n√£o estiver vazia -->
    <ul class="livros-list">
      <!-- Lista n√£o ordenada (sem numera√ß√£o) -->
      
      {% for livro in livros %}
        <!-- Loop que percorre cada livro na lista -->
        <!-- Para cada livro, cria um item na lista -->
        
        <li class="livro-item">
          <!-- Item da lista (um livro) -->
          
          <div class="livro-info">
            <!-- Div com as informa√ß√µes do livro -->
            <strong>ID: {{ livro.id }}</strong> ‚Äî {{ livro.titulo }} <em>({{ livro.autor }})</em>
            <!-- 
            {{ livro.id }} = exibe o ID do livro
            {{ livro.titulo }} = exibe o t√≠tulo do livro
            {{ livro.autor }} = exibe o autor do livro
            <strong> = texto em negrito
            <em> = texto em it√°lico
            -->
          </div>
          
          <div class="livro-actions">
            <!-- Div com os bot√µes de a√ß√£o (excluir) -->
            
            <form action="/livros/{{ livro.id }}/excluir" method="post" style="display: inline;" 
                  onsubmit="return confirm('Tem certeza que deseja excluir este livro?');">
              <!-- 
              action="/livros/{{ livro.id }}/excluir" = envia para a rota de exclus√£o
                - {{ livro.id }} √© substitu√≠do pelo ID real do livro
                - Exemplo: /livros/1/excluir
              method="post" = m√©todo HTTP POST (usado para a√ß√µes que modificam dados)
              display: inline = faz o formul√°rio aparecer na mesma linha (n√£o quebra linha)
              onsubmit = JavaScript que executa antes de enviar o formul√°rio
                - confirm() mostra uma caixa de di√°logo perguntando se tem certeza
                - Se o usu√°rio clicar "Cancelar", retorna false e n√£o envia o formul√°rio
                - Se clicar "OK", retorna true e envia o formul√°rio
              -->
              
              <button type="submit" class="btn-excluir">üóëÔ∏è Excluir</button>
              <!-- Bot√£o que envia o formul√°rio (exclui o livro) -->
            </form>
          </div>
        </li>
      {% endfor %}
      <!-- Fim do loop -->
    </ul>
  {% else %}
    <!-- Se a lista de livros estiver vazia -->
    <div class="empty-message">
      <!-- Mensagem quando n√£o h√° livros -->
      Nenhum livro cadastrado ainda. Importe um arquivo CSV para come√ßar!
    </div>
  {% endif %}
  <!-- Fim da verifica√ß√£o se h√° livros -->
</div>
<!-- Fim do container principal -->

</body>
</html>
<!-- Fim do arquivo HTML -->
